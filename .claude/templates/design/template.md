---
id: [STORY_ID]
feature: [機能名]
type: design
version: 1.0.0
created: [YYYY-MM-DD]
based_on: specs/stories/[STORY_ID]-[title]/requirements.md
---

# [機能名] Design Document

## 概要

[この機能の目的と概要を2-3文で説明]

## 背景とコンテキスト

### 前提となるADR

- [ADRファイル名]: [関連する決定事項]
- 共通技術ADRがある場合は参照

### 合意事項チェックリスト

#### スコープ
- [ ] [変更する機能/コンポーネント]
- [ ] [追加する機能]

#### 非スコープ（明示的に変更しないもの）
- [ ] [変更しない機能/コンポーネント]
- [ ] [保持する既存ロジック]

#### 制約条件
- [ ] 並行運用: [あり/なし]
- [ ] 後方互換性: [必要/不要]
- [ ] パフォーマンス測定: [必要/不要]

### 解決する問題

[この機能が解決しようとしている具体的な問題や課題]

### 現状の課題

[現在のシステムの問題点や制限]

### 要件

#### 機能要件

- [必須の機能要件を列挙]

#### 非機能要件

- **パフォーマンス**: [応答時間、スループットなどの要件]
- **スケーラビリティ**: [負荷増加時の対応要件]
- **信頼性**: [エラー率、可用性などの要件]
- **保守性**: [コードの理解しやすさ、変更のしやすさ]

## 受入条件（AC）

各機能要件に対して、実装が成功したと判断できる具体的かつ検証可能な条件を定義します。
これらの条件は、テストケースの基準となり、実装の完了を客観的に判定するために使用されます。

**進捗管理**: 受入条件の達成状況は作業計画書で追跡します。Design Docは仕様定義のみを記載します。

### EARS記法による記述ガイドライン

受入条件はEARS（Easy Approach to Requirements Syntax）記法を用いて、曖昧さを排除した明確で検証可能な形式で記述すること。

**EARS記法の6パターン**:
- **遍在型（Ubiquitous）**: システムは[動作]を行うこと
- **契機型（Event-driven）**: [イベント]が発生したとき、システムは[動作]を行うこと
- **状態型（State-driven）**: [状態]の間、システムは[動作]を行うこと
- **選択型（Optional）**: もし[条件]ならば、システムは[動作]を行うこと
- **複合型（Complex）**: [状態]の間に[イベント]が発生したとき、システムは[動作]を行うこと
- **不測型（Unwanted）**: もし[異常]が発生した場合、システムは[対処]を行うこと

### 記述例

#### AC1: ユーザー認証機能
- 契機型: ユーザーがログインボタンをクリックしたとき、システムは認証情報を検証すること
- 選択型: もし認証情報が正しければ、システムはユーザーをダッシュボードにリダイレクトすること
- 選択型: もし認証情報が無効であれば、システムは「ユーザー名またはパスワードが正しくありません」というエラーメッセージを表示すること
- 不測型: もし認証APIがタイムアウトした場合、システムは「接続エラーが発生しました。しばらくしてから再試行してください」というメッセージを表示すること

#### AC2: データ一覧表示機能
- 遍在型: システムはデータ一覧を10件ずつページネーションして表示すること
- 契機型: ユーザーが検索フィールドに入力したとき、システムはリアルタイムでデータをフィルタリングすること
- 状態型: データ取得中、システムはローディングスピナーを表示すること
- 選択型: もし検索結果が0件であれば、システムは「該当するデータが見つかりませんでした」というメッセージを表示すること

## 既存コードベース分析

### 実装パスマッピング
| 種別 | パス | 説明 |
|------|------|------|
| 既存 | {backend,frontend}/src/[実際のパス] | [現在の実装] |
| 新規 | {backend,frontend}/src/[計画パス] | [新規作成予定] |

### 統合点（新規実装でも記載）
- **統合先**: [どこと接続するか]
- **呼び出し方法**: [どのように呼び出されるか]

## 設計

### 変更影響マップ

```yaml
変更対象: [変更するコンポーネント/機能]
直接影響:
  - [直接変更が必要なファイル/関数]
  - [インターフェース変更箇所]
間接影響:
  - [データ形式の変更]
  - [処理時間の変化]
波及なし:
  - [影響を受けない機能を明示]
```

### アーキテクチャ概要

[システム全体の中でこの機能がどのように位置づけられるか]

### データフロー

```
[データの流れを図や疑似コードで表現]
```

### 統合点一覧

| 統合点 | 場所 | 旧実装 | 新実装 | 切り替え方法 |
|---------|------|----------|----------|-------------|
| 統合点1 | [クラス/関数] | [既存処理] | [新処理] | [DI/ファクトリ等] |
| 統合点2 | [別の箇所] | [既存] | [新規] | [方法] |

## UI設計（UI実装を含む機能でのみ記載）

**このセクションはUI実装を含む機能でのみ記載。非UIタスクでは省略可。**

### 画面構造マップ

**Figmaデータソース**: `specs/stories/[STORY_ID]-[title]/design-cache/outline.json` または `components/[Screen].json`

#### 画面全体の階層構造

```
[画面名]
├── [セクション1]
│   ├── [コンポーネント1-1]
│   │   ├── [要素1-1-1]
│   │   └── [要素1-1-2]
│   └── [コンポーネント1-2]
└── [セクション2]
    ├── [コンポーネント2-1]
    └── [コンポーネント2-2]
```

**記載例**:
```
Dashboard画面
├── Header
│   ├── Logo
│   ├── Title: "タスク管理システム"
│   └── UserIcon
├── StatsCards (横並び・3カード)
│   ├── TodayTaskCard
│   ├── CompletionRateCard
│   └── OverdueCard
└── ChartsSection (2列レイアウト)
    ├── ProjectProgressChart (横棒プログレスバー)
    └── RecentActivityList (リスト)
```

#### コンポーネント配置

| セクション | 配置 | コンポーネント数 | レイアウト | UI要素タイプ |
|----------|------|-----------------|-----------|-------------|
| [セクション名] | [位置] | [数] | [flexbox/grid等] | [カード/リスト/チャート等] |

**記載例**:
| セクション | 配置 | コンポーネント数 | レイアウト | UI要素タイプ |
|----------|------|-----------------|-----------|-------------|
| StatsCards | 上部 | 3 | flex-row, gap-4 | カード |
| ChartsSection | 中部 | 2 | grid-cols-2, gap-6 | チャート+リスト |

#### 画面構造の受入条件（EARS記法）

- **AC-Structure-1** (遍在型): システムは[セクション名]を[コンポーネント数]個[配置方法]で表示すること
- **AC-Structure-2** (遍在型): システムは[コンポーネント名]を[UI要素タイプ]形式で表示すること
- **AC-Structure-3** (選択型): もし[条件]の場合、システムは[動作]を行うこと

**記載例**:
- **AC-Structure-1** (遍在型): システムはStatsCardsを3つ横並び（flex-row, gap-4）で表示すること
- **AC-Structure-2** (遍在型): システムはProjectProgressChartを横棒プログレスバー形式で表示すること
- **AC-Structure-3** (選択型): もしStatsCardsに4つ目のカードが追加された場合、システムはFigmaデザインの更新を要求すること

### UIコンポーネント仕様

#### デザインデータソース

**Figmaキャッシュディレクトリ**: `specs/stories/[STORY_ID]-[title]/design-cache/`

| ファイル | 用途 | 参照方法 |
|---------|------|---------|
| `metadata.json` | メタデータ（取得日時、URL） | 更新日時確認 |
| `variables.json` | デザイントークン（色、spacing等） | CSS変数・Tailwind設定 |
| `components/[Component].json` | コンポーネント詳細仕様 | 実装時の精密参照 |

**注意**: `_mcp_response`内のデータ構造は実行時に判断すること（@steering/ui-design-integration.md参照）

#### デザイントークン定義

**データソース**: `specs/stories/[STORY_ID]-[title]/design-cache/variables.json`

| トークン名 | Figma変数 | 値 | CSS変数 / Tailwind |
|----------|-----------|-----|-------------------|
| [トークン名] | [変数パス] | [値] | [CSS変数名 / Tailwindクラス] |

**記載例**:
| トークン名 | Figma変数 | 値 | CSS変数 / Tailwind |
|----------|-----------|-----|-------------------|
| Primary Color | colors.primary | #007AFF | --color-primary / bg-primary |
| Spacing MD | spacing.md | 16px | --spacing-md / space-4 |
| Font Size Body | typography.body | 16px | --font-size-body / text-base |

**実装方法**: @steering/ui-design-integration.mdの「データ抽出ルール」を参照

#### コンポーネント別UI仕様

##### [ComponentName] コンポーネント

**Figmaデータソース**: `specs/stories/[STORY_ID]-[title]/design-cache/components/[ComponentName].json`

**デザイン仕様**:
- サイズ: [width]px × [height]px
- 背景色: [color] (`variables.json:[パス]`)
- テキスト色: [color]
- ボーダー半径: [radius]px
- フォントサイズ: [size]px (`variables.json:[パス]`)

**状態バリエーション**:
| 状態 | 背景色 | 不透明度 | カーソル | その他 |
|-----|--------|---------|---------|--------|
| Default | [color] | [opacity] | [cursor] | [備考] |
| Hover | [color] | [opacity] | [cursor] | [備考] |
| Active | [color] | [opacity] | [cursor] | [備考] |
| Disabled | [color] | [opacity] | [cursor] | [備考] |

**機能との紐付け**:
- **関連機能**: [機能ID]-[機能名]（[機能概要]）
- **API呼び出し**: [Method] [endpoint]
- **データフロー**: [入力] → [処理] → [出力]

**UI受入条件（EARS記法）**:
- **AC-UI-1** (遍在型): システムは[ComponentName]を[width]px × [height]pxで表示すること
- **AC-UI-2** (契機型): ユーザーが[ComponentName]に[イベント]したとき、システムは[動作]を行うこと
- **AC-UI-3** (選択型): もし[条件]の場合、システムは[動作]を行うこと
- **AC-UI-4** (不測型): もし[異常]が発生した場合、システムは[対処]を行うこと

**実装ファイル**: [実装予定パス]
**Props定義**: [必要なProps]
**状態管理**: [状態管理方法]

---

### 主要コンポーネント

#### コンポーネント1

- **責務**: [このコンポーネントの責任範囲]
- **インターフェース**: [提供するAPIや型定義]
- **依存関係**: [他のコンポーネントとの関係]

#### コンポーネント2

- **責務**: [このコンポーネントの責任範囲]
- **インターフェース**: [提供するAPIや型定義]
- **依存関係**: [他のコンポーネントとの関係]

### 型定義

```typescript
// 主要な型定義をここに記載
```

### データ契約（Data Contract）

#### コンポーネント1

```yaml
入力:
  型: [TypeScript型定義]
  前提条件: [必須項目、形式制約]
  検証: [バリデーション方法]

出力:
  型: [TypeScript型定義]
  保証: [必ず満たす条件]
  エラー時: [例外/null/デフォルト値]

不変条件:
  - [処理の前後で変わらない条件]
```

### 状態遷移と不変条件（該当する場合）

```yaml
状態定義:
  - 初期状態: [初期値と条件]
  - 遷移可能状態: [状態のリスト]

状態遷移:
  現在状態 → イベント → 次状態

システム不変条件:
  - [どの状態でも成立する条件]
```

### エラーハンドリング

[エラーの種類と対処方法]

### ログとモニタリング

[何をログに記録し、どのようにモニタリングするか]

## 実装計画

### 実装アプローチ

**選択したアプローチ**: [アプローチ名または組み合わせ]
**選択理由**: [プロジェクトの制約と技術的依存関係を考慮した理由]

### 技術的依存関係と実装順序

#### 実装の必要順序
1. **[コンポーネント/機能A]**
   - 技術的理由: [なぜこれを最初に実装する必要があるか]
   - 依存される要素: [これに依存する他のコンポーネント]

2. **[コンポーネント/機能B]**
   - 技術的理由: [Aの後に実装する技術的必然性]
   - 前提条件: [必要な事前実装]

#### 並列実装可能な要素
- [独立して実装可能なコンポーネント群]

### 統合ポイントとE2E確認

#### 統合ポイント1: [統合箇所]
**確認手順**:
1. [動作確認手順]
2. [期待結果の確認]

#### 統合ポイント2: [統合箇所]
**確認手順**:
1. [動作確認手順]
2. [期待結果の確認]

### 移行戦略

[技術的な移行アプローチ、後方互換性の確保方法]

## テスト戦略

### テスト設計の基本方針

受入条件から自動的にテストケースを導出：
- 各受入条件に対して最低1つのテストケースを作成
- 受入条件の測定可能な基準をアサーションとして実装

### 単体テスト

[単体テストの方針とカバレッジ目標]
- 機能受入条件の個別要素を検証

### 統合テスト

[統合テストの方針と重要なテストケース]
- 機能受入条件の結合動作を検証

### E2Eテスト

[E2Eテストの方針]
- 受入条件のシナリオ全体を検証
- ユーザー視点での機能動作を確認

### パフォーマンステスト

[パフォーマンステストの方法と基準]
- 非機能受入条件のパフォーマンス基準を検証

## セキュリティ考慮事項

[セキュリティ上の懸念事項と対策]

## 今後の拡張性

[将来的な機能追加や変更に対する考慮]

## 代替案の検討

### 代替案1

- **概要**: [代替案の説明]
- **利点**: [利点]
- **欠点**: [欠点]
- **不採用の理由**: [なぜ採用しなかったか]

## リスクと軽減策

| リスク | 影響度 | 発生確率 | 軽減策 |
|--------|--------|----------|--------|
| [リスク1] | 高/中/低 | 高/中/低 | [対策] |

## 参考資料

- [関連するドキュメントやリンク]

## 更新履歴

| 日付 | 版 | 変更内容 | 作成者 |
|------|-----|----------|--------|
| YYYY-MM-DD | 1.0 | 初版作成 | [名前] |